"use strict";(globalThis.webpackChunk_openmrs_esm_form_builder_app=globalThis.webpackChunk_openmrs_esm_form_builder_app||[]).push([[6735],{26735:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O});var r=n(16072),a=n.n(r),o=n(53941),i=n(44906),l=n(84370),u=n(28504),s=n(92137),c=n(25987),d=n(43687),p=n(59324),m=n(77646),f=n(64945),v=n(56603),g=n(99130),y=n(78538),h=n(91608);function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){E(e,t,n[t])}))}return e}function k(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function S(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,l=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){l=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(l)throw a}}return o}}(e,t)||A(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||A(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}const O=function(e){var t,n,b,E,A,O,C,w,x,N,I,L,P,F,j,D,M,B,R,U,W,Q,_=e.closeModal,z=e.onSchemaChange,K=e.pageIndex,H=e.questionIndex,V=e.questionToEdit,$=e.schema,Y=e.sectionIndex,J=(0,o.useTranslation)().t,X=(0,c.useConfig)(),G=X.fieldTypes,Z=X.questionTypes,ee=S((0,r.useState)([]),2),te=ee[0],ne=ee[1],re=S((0,r.useState)(V.questionOptions.conceptMappings),2),ae=re[0],oe=re[1],ie=S((0,r.useState)(""),2),le=ie[0],ue=ie[1],se=S((0,r.useState)(""),2),ce=se[0],de=se[1],pe=S((0,r.useState)(""),2),me=pe[0],fe=pe[1],ve=S((0,r.useState)(""),2),ge=ve[0],ye=ve[1],he=S((0,r.useState)(V.questionOptions.rendering),2),be=he[0],Ee=he[1],Te=S((0,r.useState)(!1),2),ke=Te[0],Se=Te[1],qe=S((0,r.useState)(null!==(D=V.questionOptions.max)&&void 0!==D?D:""),2),Ae=qe[0],Oe=qe[1],Ce=S((0,r.useState)(null!==(M=V.questionOptions.min)&&void 0!==M?M:""),2),we=Ce[0],xe=Ce[1],Ne=S((0,r.useState)(""),2),Ie=Ne[0],Le=Ne[1],Pe=S((0,r.useState)(""),2),Fe=Pe[0],je=Pe[1],De=S((0,r.useState)(V.value),2),Me=De[0],Be=De[1],Re=S((0,r.useState)(null),2),Ue=Re[0],We=Re[1],Qe=S((0,r.useState)(null!==(B=V.datePickerFormat)&&void 0!==B?B:"both"),2),_e=Qe[0],ze=Qe[1],Ke=S((0,r.useState)(""),2),He=Ke[0],Ve=Ke[1],$e=S((0,r.useState)(null),2),Ye=$e[0],Je=$e[1],Xe=S((0,r.useState)([]),2),Ge=Xe[0],Ze=Xe[1],et=S((0,r.useState)([]),2),tt=et[0],nt=et[1],rt=(0,d.M)(ce),at=rt.concepts,ot=rt.conceptLookupError,it=rt.isLoadingConcepts,lt=S((0,r.useState)(null),2),ut=lt[0],st=lt[1],ct=(R=V.questionOptions.concept,W="".concat(c.restBaseUrl,"/concept/").concat(R),Q=(0,p.Ay)(R?W:null,c.openmrsFetch).data,{concept:null!==(U=null==Q?void 0:Q.data)&&void 0!==U?U:null}).concept,dt=(0,d.M)(le),pt=dt.concepts,mt=dt.isLoadingConcepts,ft=function(e){var t,n,r,a="".concat(c.restBaseUrl,"/concept/").concat(e,"?v=").concat("custom:(name:(display))"),o=(0,p.Ay)(e?a:null,c.openmrsFetch),i=o.data,l=o.error;return{conceptName:null!==(r=null==i||null===(n=i.data)||void 0===n||null===(t=n.name)||void 0===t?void 0:t.display)&&void 0!==r?r:null,conceptNameLookupError:l,isLoadingConceptName:e&&!i&&!l||!1}}(V.questionOptions.concept),vt=ft.conceptName,gt=ft.conceptNameLookupError,yt=ft.isLoadingConceptName,ht=(0,m.d)().patientIdentifierTypes,bt=(0,f.O)().personAttributeTypes,Et=function(e){var t,n="".concat(c.restBaseUrl,"/patientidentifiertype/").concat(e),r=(0,p.Ay)(e?n:null,c.openmrsFetch),a=r.data,o=r.error,i=r.isLoading;return{patientIdentifierType:null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{},conceptLookupError:o,isLoadingPatientIdentifierType:i}}(ge).patientIdentifierType,Tt=function(e){var t,n="".concat(c.restBaseUrl,"/personattributetype?q=").concat(e,"&v=default"),r=(0,p.Ay)(e?n:null,c.openmrsFetch),a=r.data,o=r.error,i=r.isLoading;return{personAttributeType:null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{},personAttributeLookupError:o,isLoadingPersonAttributeType:i}}(me).personAttributeType,kt=S((0,r.useState)(Et),2),St=kt[0],qt=kt[1],At=S((0,r.useState)(Tt),2),Ot=At[0],Ct=At[1],wt=function(e){var t,n,r="".concat(c.restBaseUrl,"/patientidentifiertype/").concat(e),a=(0,p.Ay)(e?r:null,c.openmrsFetch),o=a.data,i=a.error,l=a.isLoading;return{patientIdentifierName:null!==(n=null==o||null===(t=o.data)||void 0===t?void 0:t.name)&&void 0!==n?n:null,patientIdentifierNameLookupError:i,isLoadingPatientidentifierName:l||!1}}(V.questionOptions.identifierType),xt=wt.patientIdentifierNameLookupError,Nt=wt.isLoadingPatientidentifierName,It=function(e){var t,n,r="".concat(c.restBaseUrl,"/personattributetype?q=").concat(e,"&v=default"),a=(0,p.Ay)(e?r:null,c.openmrsFetch),o=a.data,i=a.error,l=a.isLoading;return{personAttributeName:null!==(n=null==o||null===(t=o.data)||void 0===t?void 0:t.name)&&void 0!==n?n:null,personAttributeNameLookupError:i,isLoadingPersonAttributeName:l||!1}}(V.questionOptions.attributeType),Lt=It.personAttributeNameLookupError,Pt=It.isLoadingPersonAttributeName,Ft=S((0,r.useState)(!1),2),jt=Ft[0],Dt=Ft[1],Mt=S((0,r.useState)([]),2),Bt=Mt[0],Rt=Mt[1],Ut=S((0,r.useState)(null),2),Wt=Ut[0],Qt=Ut[1],_t=S((0,r.useState)(null),2),zt=_t[0],Kt=_t[1],Ht=(0,v.v5)(),Vt=Ht.programs,$t=Ht.programsLookupError,Yt=Ht.isLoadingPrograms,Jt=(0,v.D0)(null==zt?void 0:zt.uuid),Xt=Jt.programStates,Gt=Jt.programStatesLookupError,Zt=Jt.isLoadingProgramStates,en=Jt.mutateProgramStates,tn=S((0,r.useState)([]),2),nn=tn[0],rn=tn[1],an=ut&&(null==V?void 0:V.questionOptions.concept)&&(null==V||null===(t=V.questionOptions)||void 0===t?void 0:t.concept)!==(null==ut?void 0:ut.uuid),on=S((0,r.useState)(!1),2),ln=on[0],un=on[1],sn=S((0,r.useState)(null==V||null===(b=V.questionOptions)||void 0===b||null===(n=b.toggleOptions)||void 0===n?void 0:n.labelTrue),2),cn=sn[0],dn=sn[1],pn=S((0,r.useState)(null==V||null===(A=V.questionOptions)||void 0===A||null===(E=A.toggleOptions)||void 0===E?void 0:E.labelFalse),2),mn=pn[0],fn=pn[1],vn={datetime:[{value:"both",label:J("calendarAndTimer","Calendar and timer"),defaultChecked:!0}],date:[{value:"calendar",label:J("calendarOnly","Calendar only"),defaultChecked:!1}],time:[{value:"timer",label:J("timerOnly","Timer only"),defaultChecked:!1}]},gn=(0,r.useMemo)((function(){return(0,i.A)((function(e){return ue(e)}),500)}),[]);(0,r.useEffect)((function(){var e=Vt.find((function(e){return e.uuid===V.questionOptions.programUuid}));Qt(e)}),[Vt,V.questionOptions.programUuid]),(0,r.useEffect)((function(){var e=null==Wt?void 0:Wt.allWorkflows.find((function(e){return e.uuid===V.questionOptions.workflowUuid}));Kt(e),rn(null==Wt?void 0:Wt.allWorkflows)}),[V.questionOptions.workflowUuid,Wt]),(0,r.useEffect)((function(){var e=null==zt?void 0:zt.states.filter((function(e){return V.questionOptions.answers.some((function(t){return t.value===e.uuid}))}));Rt(e)}),[zt,V.questionOptions.answers]),(0,r.useEffect)((function(){var e;if(null==V||null===(e=V.questionOptions)||void 0===e?void 0:e.answers){var t=V.questionOptions.answers.map((function(e){return{id:e.concept,text:e.label}}));Ze(t)}}),[V]);var yn=(0,r.useMemo)((function(){var e,t,n,r=[];return null==ct||null===(e=ct.answers)||void 0===e||e.map((function(e){r.push({id:e.uuid,text:e.display})})),null==V||null===(n=V.questionOptions)||void 0===n||null===(t=n.answers)||void 0===t||t.map((function(e){var t;r.some((function(t){return t.id===e.concept}))||r.push({id:e.concept,text:null!==(t=e.label)&&void 0!==t?t:""})})),r}),[V,ct]);return a().createElement(a().Fragment,null,a().createElement(u.rQ0,{className:h.A.modalHeader,closeModal:_,title:J("editQuestion","Edit question")}),a().createElement(u.lVW,{className:h.A.form,onSubmit:function(e){return e.preventDefault()}},a().createElement(u.cwr,{hasScrollingContent:!0},a().createElement(u.BJc,{gap:5},"markdown"===V.questionOptions.rendering||"markdown"===be?a().createElement(y.A,{placeholder:V.value,onValueChange:Be}):a().createElement(u.ksK,{defaultValue:V.label,id:V.id,labelText:J("questionLabel","Label"),onChange:function(e){return je(e.target.value)}}),a().createElement(u.ksK,{defaultValue:V.id,id:"questionId",invalid:function(e){var t;if((null==V?void 0:V.id)===e)return!1;var n=null==$||null===(t=$.pages)||void 0===t?void 0:t.map((function(e){var t;return null==e||null===(t=e.sections)||void 0===t?void 0:t.map((function(e){var t;return null==e||null===(t=e.questions)||void 0===t?void 0:t.map((function(e){return e.id}))}))}));return(0,l.A)(n).includes(e)}(Ie),invalidText:J("questionIdExists","This question ID already exists in your schema"),labelText:J("questionId","Question ID (prefer using camel-case for IDs). Each field should have a unique ID."),onChange:function(e){return Le(e.target.value)},placeholder:J("questionIdPlaceholder",'Enter a unique ID e.g. "anaesthesiaType" for a question asking about the type of anaesthesia.'),required:!0}),("markdown"!==V.questionOptions.rendering||"markdown"!==be)&&a().createElement(a().Fragment,null,a().createElement(u.zWQ,{defaultSelected:/true/.test(null==V||null===(O=V.required)||void 0===O?void 0:O.toString())?"required":"optional",name:"isQuestionRequired",legendText:J("isQuestionRequiredOrOptional","Is this question a required or optional field? Required fields must be answered before the form can be submitted.")},a().createElement(u.aaP,{id:"questionIsNotRequired",defaultChecked:!0,labelText:J("optional","Optional"),onClick:function(){return Se(!1)},value:"optional"}),a().createElement(u.aaP,{id:"questionIsRequired",defaultChecked:!1,labelText:J("required","Required"),onClick:function(){return Se(!0)},value:"required"})),a().createElement(u.l6P,{defaultValue:V.type,onChange:function(e){return We(e.target.value)},id:"questionType",invalidText:J("typeRequired","Type is required"),labelText:J("questionType","Question type"),required:!0},!Ue&&a().createElement(u.ebT,{text:J("chooseQuestionType","Choose a question type"),value:""}),Z.map((function(e,t){return a().createElement(u.ebT,{text:e,value:e,key:t})})))),a().createElement(u.l6P,{defaultValue:V.questionOptions.rendering,onChange:function(e){return Ee(e.target.value)},id:"renderingType",invalidText:J("validFieldTypeRequired","A valid field type value is required"),labelText:J("renderingType","Rendering type"),required:!0},!be&&a().createElement(u.ebT,{text:J("chooseRenderingType","Choose a rendering type"),value:""}),G.map((function(e,t){return a().createElement(u.ebT,{text:e,value:e,key:t})}))),"number"===be?a().createElement(a().Fragment,null,a().createElement(u.ksK,{id:"min",labelText:"Min",value:we||"",invalid:parseFloat(we)>parseFloat(Ae),invalidText:parseFloat(we)>parseFloat(Ae)?J("invalidMinMax","Min value cannot be greater than max"):"",onChange:function(e){return xe(e.target.value)},required:!0}),a().createElement(u.ksK,{id:"max",labelText:"Max",value:Ae||"",invalid:parseFloat(we)>parseFloat(Ae),invalidText:parseFloat(we)>parseFloat(Ae)?J("invalidMinMax","Min value cannot be greater than max"):"",onChange:function(e){return Oe(e.target.value)},required:!0})):"textarea"===be?a().createElement(u.ksK,{id:"textAreaRows",labelText:J("rows","Rows"),value:He||"",onChange:function(e){return Ve(e.target.value)},required:!0}):"toggle"===be?a().createElement("div",null,a().createElement(u.ksK,{id:"lableTrue",labelText:J("labelTrue","Label true"),value:J(cn||""),onChange:function(e){return dn(e.target.value)},placeholder:J("on","On"),required:!0}),a().createElement(u.ksK,{id:"lableFalse",labelText:J("labelFalse","Label false"),value:J(mn||""),onChange:function(e){return fn(e.target.value)},placeholder:J("off","Off"),required:!0})):null,"patientIdentifier"===V.type&&a().createElement("div",null,a().createElement(u.lRv,{className:h.A.label},J("searchForBackingPatientIdentifierType","Search for a backing patient identifier type")),xt?a().createElement(u.jeF,{kind:"error",lowContrast:!0,className:h.A.error,title:J("errorFetchingPatientIdentifierTypes","Error fetching patient identifier types"),subtitle:J("pleaseTryAgain","Please try again.")}):null,Nt?a().createElement(u.OuH,{className:h.A.loader,description:J("loading","Loading")+"..."}):a().createElement(u.a32,{id:"patientIdentifierTypeLookup",items:ht,itemToString:function(e){return null==e?void 0:e.display},onChange:function(e){var t;t=e.selectedItem,ye(""),qt(t)},placeholder:J("choosePatientIdentifierType","Choose a patient identifier type"),initialSelectedItem:ht.find((function(e){var t;return(null==e?void 0:e.uuid)===(null===(t=V.questionOptions)||void 0===t?void 0:t.identifierType)}))})),"personAttribute"===V.type&&a().createElement("div",null,a().createElement(u.lRv,{className:h.A.label},J("searchForBackingPersonAttributeType","Search for a backing person attribute type")),Lt?a().createElement(u.jeF,{kind:"error",lowContrast:!0,className:h.A.error,title:J("errorFetchingPersonAttributeTypes","Error fetching person attribute types"),subtitle:J("pleaseTryAgain","Please try again.")}):null,Pt?a().createElement(u.OuH,{className:h.A.loader,description:J("loading","Loading")+"..."}):a().createElement(u.a32,{id:"personAttributeTypeLookup",items:bt,itemToString:function(e){return null==e?void 0:e.display},onChange:function(e){var t;t=e.selectedItem,fe(""),Ct(t)},placeholder:J("choosePersonAttributeType","Choose a person attribute type"),initialSelectedItem:bt.find((function(e){var t;return(null==e?void 0:e.uuid)===(null===(t=V.questionOptions)||void 0===t?void 0:t.attributeType)}))})),"programState"===V.type&&a().createElement(u.BJc,{gap:5},Yt&&a().createElement(u.aB4,null),$t?a().createElement(u.jeF,{kind:"error",lowContrast:!0,className:h.A.error,title:J("errorFetchingPrograms","Error fetching programs"),subtitle:J("pleaseTryAgain","Please try again.")}):null,Vt&&a().createElement(u.a32,{id:"programLookup",items:Vt,itemToString:function(e){return null==e?void 0:e.name},onChange:function(e){var t;t=e.selectedItem,Qt(t),rn(null==t?void 0:t.allWorkflows)},placeholder:J("addProgram","Add program"),selectedItem:Wt,titleText:J("program","Program")}),Wt&&a().createElement(u.a32,{id:"programWorkflowLookup",items:nn,itemToString:function(e){var t,n;return null!==(n=null==e||null===(t=e.concept)||void 0===t?void 0:t.display)&&void 0!==n?n:""},onChange:function(e){return t=e.selectedItem,Kt(t),void en();var t},placeholder:J("addProgramWorkflow","Add program workflow"),selectedItem:zt,titleText:J("programWorkflow","Program workflow")}),zt&&a().createElement(a().Fragment,null,Zt&&a().createElement(u.aB4,null),Gt&&a().createElement(u.jeF,{kind:"error",lowContrast:!0,className:h.A.error,title:J("errorFetchingProgramState","Error fetching program state"),subtitle:J("pleaseTryAgain","Please try again.")}),(null==Xt?void 0:Xt.length)>0&&a().createElement(u.KFt,{titleText:J("programState","Program state"),id:"programState",items:Xt,itemToString:function(e){var t;return e?null==e||null===(t=e.concept)||void 0===t?void 0:t.display:""},selectionFeedback:"top-after-reopen",onChange:function(e){return Rt(e.selectedItems)},selectedItems:Bt}),a().createElement("div",null,null==Bt?void 0:Bt.map((function(e){var t;return a().createElement(u.vwO,{className:h.A.tag,key:null==e?void 0:e.uuid,type:"blue"},null==e||null===(t=e.concept)||void 0===t?void 0:t.display)}))))),"ui-select-extended"!==be&&"encounterDatetime"!==V.type&&("obs"===Ue||!Ue&&"obs"===V.type)&&a().createElement(a().Fragment,null,a().createElement("div",null,a().createElement(u.lRv,{className:h.A.label},J("searchForBackingConcept","Search for a backing concept")),gt?a().createElement(u.jeF,{kind:"error",lowContrast:!0,className:h.A.error,title:J("errorFetchingConceptName","Couldn't resolve concept name"),subtitle:J("conceptDoesNotExist","The linked concept '{{conceptName}}' does not exist in your dictionary",{conceptName:V.questionOptions.concept})}):null,yt?a().createElement(u.OuH,{className:h.A.loader,description:J("loading","Loading")+"..."}):a().createElement(a().Fragment,null,a().createElement(u.vji,{defaultValue:vt,id:"conceptLookup",onClear:function(){st(null),ze("both")},onChange:function(e){var t,n;(n=null===(t=e.target.value)||void 0===t?void 0:t.trim())&&gn(n)},placeholder:J("searchConcept","Search using a concept name or UUID"),required:!0,size:"md",value:null==ut?void 0:ut.display}),le?mt?a().createElement(u.OuH,{className:h.A.loader,description:J("searching","Searching")+"..."}):(null==pt?void 0:pt.length)&&!mt?a().createElement("ul",{className:h.A.conceptList},null==pt?void 0:pt.map((function(e,t){return a().createElement("li",{role:"menuitem",className:h.A.concept,key:t,onClick:function(){return function(e){var t,n,r,a=(0,g.getDatePickerType)(e);a&&ze(a),ue(""),Ze([]),nt([]),st(e),oe(null==e||null===(t=e.mappings)||void 0===t?void 0:t.map((function(e){var t=e.display.split(": ");return{relationship:e.conceptMapType.display,type:t[0],value:t[1]}}))),ne(null!==(r=null==e||null===(n=e.answers)||void 0===n?void 0:n.map((function(e){return{concept:null==e?void 0:e.uuid,label:null==e?void 0:e.display}})))&&void 0!==r?r:[])}(e)}},e.display)}))):a().createElement(u.Wdr,null,a().createElement(u.FAs,{className:h.A.emptyResults},a().createElement("span",null,J("noMatchingConcepts","No concepts were found that match")," ",a().createElement("strong",null,'"',le,'".'))),a().createElement("div",{className:h.A.oclLauncherBanner},a().createElement("p",{className:h.A.bodyShort01},J("conceptSearchHelpText","Can't find a concept?")),a().createElement("a",{className:h.A.oclLink,target:"_blank",rel:"noopener noreferrer",href:"https://app.openconceptlab.org/"},J("searchInOCL","Search in OCL"),a().createElement(s.F1,{size:16})))):null)),a().createElement(u.BJc,{gap:5},!an&&(null==V||null===(C=V.questionOptions.answers)||void 0===C?void 0:C.length)&&"programState"!==V.type?a().createElement(u.KFt,{className:h.A.multiSelect,direction:"top",id:"selectAnswers",itemToString:function(e){return e.text},initialSelectedItems:null==V||null===(x=V.questionOptions)||void 0===x||null===(w=x.answers)||void 0===w?void 0:w.map((function(e){return{id:e.concept,text:e.label}})),items:yn,onChange:function(e){var t=e.selectedItems;Ze(t)},size:"md",titleText:J("selectAnswersToDisplay","Select answers to display")}):null,!an&&Ge.length&&"programState"!==V.type?a().createElement("div",null,null==Ge?void 0:Ge.map((function(e){return a().createElement(u.vwO,{className:h.A.tag,key:null==e?void 0:e.id,type:"blue"},null==e?void 0:e.text)}))):null,an&&te.length?a().createElement(u.KFt,{className:h.A.multiSelect,direction:"top",id:"selectAnswers",itemToString:function(e){return e.text},items:te.map((function(e){return{id:e.concept,text:e.label}})),onChange:function(e){var t=e.selectedItems;return Ze(t.sort())},size:"md",titleText:J("selectAnswersToDisplay","Select answers to display")}):null,an&&Ge.length&&"programState"!==V.type?a().createElement("div",null,null==Ge?void 0:Ge.map((function(e){return a().createElement(u.vwO,{className:h.A.tag,key:null==e?void 0:e.id,type:"blue"},null==e?void 0:e.text)}))):null,ut&&"Coded"==(null===(N=ut.datatype)||void 0===N?void 0:N.display)||ct&&"Coded"==(null===(I=ct.datatype)||void 0===I?void 0:I.display)?a().createElement("div",null,a().createElement(u.lRv,{className:h.A.label},J("searchForAnswerConcept","Search for a concept to add as an answer")),ot?a().createElement(u.jeF,{kind:"error",lowContrast:!0,className:h.A.error,title:J("errorFetchingConcepts","Error fetching concepts"),subtitle:J("pleaseTryAgain","Please try again.")}):null,a().createElement(u.vji,{id:"conceptAnsLookup",onClear:function(){Je(null)},onChange:function(e){return de(e.target.value)},placeholder:J("searchConcept","Search using a concept name or UUID"),required:!0,size:"md",value:ce||(Ye?Ye.display:"")}),tt.length>0?a().createElement("div",null,tt.map((function(e){return a().createElement(u.vwO,{className:h.A.tag,key:e.id,type:"blue"},e.text,a().createElement("button",{className:h.A.conceptAnswerButton,onClick:function(){return t=e.id,n=tt.filter((function(e){return e.id!==t})),void nt(n);var t,n}},"X"))}))):null,ce?it?a().createElement(u.OuH,{className:h.A.loader,description:J("searching","Searching")+"..."}):(null==at?void 0:at.length)&&!it?a().createElement("ul",{className:h.A.conceptList},null==at?void 0:at.map((function(e,t){return a().createElement("li",{role:"menuitem",className:h.A.concept,key:t,onClick:function(){return function(e){de(""),Je(e);var t={id:e.uuid,text:e.display},n=Ge.some((function(e){return e.id===t.id})),r=tt.some((function(e){return e.id===t.id}));n||r||nt((function(e){return q(e).concat([t])}))}(e)}},e.display)}))):a().createElement(u.Wdr,null,a().createElement(u.FAs,{className:h.A.emptyResults},a().createElement("span",null,J("noMatchingConcepts","No concepts were found that match")," ",a().createElement("strong",null,"'",ce,"'."))),a().createElement("div",{className:h.A.oclLauncherBanner},a().createElement("p",{className:h.A.bodyShort01},J("conceptSearchHelpText","Can't find a concept?")),a().createElement("a",{className:h.A.oclLink,target:"_blank",rel:"noopener noreferrer",href:"https://app.openconceptlab.org/"},J("searchInOCL","Search in OCL"),a().createElement(s.F1,{size:16})))):null):null,a().createElement(u.zWQ,{defaultSelected:/true/.test(null==V||null===(P=V.questionOptions)||void 0===P||null===(L=P.showComment)||void 0===L?void 0:L.toString())?"yes":"no",name:"addObsComment",legendText:J("addObsCommentTextBox","Add obs comment text box")},a().createElement(u.aaP,{id:"obsCommentYes",defaultChecked:!0,labelText:J("yes","Yes"),onClick:function(){return Dt(!0)},value:"yes"}),a().createElement(u.aaP,{id:"obsCommentNo",defaultChecked:!1,labelText:J("no","No"),onClick:function(){return Dt(!1)},value:"no"})),a().createElement(u.zWQ,{defaultSelected:/true/.test(null==V||null===(j=V.questionOptions)||void 0===j||null===(F=j.showDate)||void 0===F?void 0:F.toString())?"yes":"no",name:"addInlineDate",legendText:J("addInlineDate","Add inline date")},a().createElement(u.aaP,{id:"inlineDateYes",defaultChecked:!0,labelText:J("yes","Yes"),onClick:function(){return un(!0)},value:"yes"}),a().createElement(u.aaP,{id:"inlineDateNo",defaultChecked:!1,labelText:J("no","No"),onClick:function(){return un(!1)},value:"no"})))),"date"===be||"datetime"===be?a().createElement(u.zWQ,{name:"datePickerType",legendText:J("datePickerType","The type of date picker to show")},ut&&ut.datatype?vn[ut.datatype.name.toLowerCase()].map((function(e){return a().createElement(u.aaP,{id:e.value,labelText:e.label,onClick:function(){return ze(e.value)},checked:_e===e.value,value:e.value})})):Object.values(vn).flat().map((function(e){return a().createElement(u.aaP,{id:e.value,checked:_e===e.value,labelText:e.label,onClick:function(){return ze(e.value)},value:e.value})}))):null)),a().createElement(u.jlY,null,a().createElement(u.$nd,{onClick:_,kind:"secondary"},J("cancel","Cancel")),a().createElement(u.$nd,{onClick:function(){var e=function(){var e=tt.filter((function(e){return!Ge.some((function(t){return t.id===e.id}))})),t=q(Ge).concat(q(e));return Ze(t),nt([]),t}();(function(e,t){var n,r,a;a=!an&&(null==t?void 0:t.length)?t.map((function(e){return{concept:e.id,label:e.text}})):an&&0===te.length?[]:an&&(null==te?void 0:te.length)>0&&(null==t?void 0:t.length)?(null==t?void 0:t.length)?t.map((function(e){return{concept:e.id,label:e.text}})):V.questionOptions.answers:"programState"===V.type?Bt.map((function(e){return{value:e.uuid,label:e.concept.display}})):V.questionOptions.answers;try{var o,i=k(T(k(T({},Fe&&{label:Fe},Me&&{value:Me}),{type:Ue||V.type,required:ke||/true/.test(null==V||null===(o=V.required)||void 0===o?void 0:o.toString()),id:Ie||V.id}),(be&&("date"===be||"datetime"===be)||"date"===V.questionOptions.rendering||"datetime"===V.questionOptions.rendering)&&{datePickerFormat:_e}),{questionOptions:T(k(T(k(T({rendering:be||V.questionOptions.rendering},we&&{min:we},Ae&&{max:Ae},(ut||V.questionOptions.concept)&&{concept:ut?ut.uuid:V.questionOptions.concept,conceptMappings:(null==ae?void 0:ae.length)?ae:V.questionOptions.conceptMappings}),{answers:a}),"patientIdentifier"===Ue&&{identifierType:St?St.uuid:V.questionOptions.identifierType},jt&&{showComment:jt||/true/.test(V.questionOptions.showComment.toString())},ln&&{showDate:ln||/true/.test(V.questionOptions.showDate.toString())}),{attributeType:Ot?Ot.uuid:V.questionOptions.attributeType}),Wt&&{programUuid:Wt.uuid},zt&&{workflowUuid:zt.uuid},"toggle"===be&&{toggleOptions:{labelTrue:cn,labelFalse:mn}})});$.pages[K].sections[Y].questions[e]=i,z(T({},$)),je(""),Le(""),Se(!1),We(null),Ee(null),st(null),oe([]),Ze([]),Dt(!1),un(!1),(0,c.showSnackbar)({title:J("questionEdited","Question edited"),kind:"success",isLowContrast:!0,subtitle:J("questionEditedMessage",'The question labelled "{{- questionLabel}}" has been edited.',{questionLabel:V.label})})}catch(e){n=e,(null!=(r=Error)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r)&&(0,c.showSnackbar)({title:J("errorUpdatingQuestion","Error updating question"),kind:"error",subtitle:null==e?void 0:e.message})}_()})(H,e),_()}},a().createElement("span",null,J("save","Save"))))))}},44906:(e,t,n)=>{n.d(t,{A:()=>h});var r=n(23149),a=n(41917);const o=function(){return a.A.Date.now()};var i=/\s/;var l=/^\s+/;const u=function(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&i.test(e.charAt(t)););return t}(e)+1).replace(l,""):e};var s=n(88496),c=n(53098);var d=/^[-+]0x[0-9a-f]+$/i,p=/^0b[01]+$/i,m=/^0o[0-7]+$/i,f=parseInt;const v=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||(0,c.A)(e)&&"[object Symbol]"==(0,s.A)(e)}(e))return NaN;if((0,r.A)(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=(0,r.A)(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=u(e);var n=p.test(e);return n||m.test(e)?f(e.slice(2),n?2:8):d.test(e)?NaN:+e};var g=Math.max,y=Math.min;const h=function(e,t,n){var a,i,l,u,s,c,d=0,p=!1,m=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){var n=a,r=i;return a=i=void 0,d=t,u=e.apply(r,n)}function b(e){var n=e-c;return void 0===c||n>=t||n<0||m&&e-d>=l}function E(){var e=o();if(b(e))return T(e);s=setTimeout(E,function(e){var n=t-(e-c);return m?y(n,l-(e-d)):n}(e))}function T(e){return s=void 0,f&&a?h(e):(a=i=void 0,u)}function k(){var e=o(),n=b(e);if(a=arguments,i=this,c=e,n){if(void 0===s)return function(e){return d=e,s=setTimeout(E,t),p?h(e):u}(c);if(m)return clearTimeout(s),s=setTimeout(E,t),h(c)}return void 0===s&&(s=setTimeout(E,t)),u}return t=v(t)||0,(0,r.A)(n)&&(p=!!n.leading,l=(m="maxWait"in n)?g(v(n.maxWait)||0,t):l,f="trailing"in n?!!n.trailing:f),k.cancel=function(){void 0!==s&&clearTimeout(s),d=0,a=c=i=s=void 0},k.flush=function(){return void 0===s?u:T(o())},k}},23149:(e,t,n)=>{n.d(t,{A:()=>r});const r=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}}}]);