"use strict";(globalThis.webpackChunk_openmrs_esm_patient_conditions_app=globalThis.webpackChunk_openmrs_esm_patient_conditions_app||[]).push([[5979],{5979:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var r=n(1343),i=n.n(r),a=n(3373),l=n.n(a),o=n(3150),u=n(824),s=n(1160),c=n(6195),d=n(2317),m=n(8254),f=n(1825),p=n(7055),b=n(6199);function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],l=!0,o=!1;try{for(n=n.call(e);!(l=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);l=!0);}catch(e){o=!0,i=e}finally{try{l||null==n.return||n.return()}finally{if(o)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const S=function(e){var t,n,a,v=e.closeWorkspace,S=e.closeWorkspaceWithSavedChanges,E=e.condition,A=e.formContext,h=e.patientUuid,C=e.promptBeforeClosing,T=(0,o.useTranslation)().t,k="tablet"===(0,m.useLayoutType)(),w=(0,f.AS)(h).conditions,N=y((0,r.useState)(!1),2),D=N[0],_=N[1],j=y((0,r.useState)(null),2),W=j[0],z=j[1],O=y((0,r.useState)(null),2),U=O[0],q=O[1],F="editing"===A,I=null==w?void 0:w.find((function(e){return(null==e?void 0:e.id)===(null==E?void 0:E.id)})),$=function(e,t){var n="creating"===e,r=c.z.string().refine((function(e){return!n||!!e}),{message:t("clinicalStatusRequired","A clinical status is required")}),i=c.z.string().refine((function(e){return!n||!!e}),{message:t("conditionRequired","A condition is required")});return c.z.object({abatementDateTime:c.z.date().optional().nullable(),clinicalStatus:r,conditionName:i,onsetDateTime:c.z.date().nullable()})}(A,T),x={abatementDateTime:F&&(null==I?void 0:I.abatementDateTime)?new Date(null==I?void 0:I.abatementDateTime):null,conditionName:"",clinicalStatus:F&&null!==(n=null==I||null===(t=I.clinicalStatus)||void 0===t?void 0:t.toLowerCase())&&void 0!==n?n:"",onsetDateTime:F&&(null==I?void 0:I.onsetDateTime)?new Date(null==I?void 0:I.onsetDateTime):null},L=(0,u.mN)({mode:"all",resolver:(0,s.u)($),defaultValues:x}),R=L.formState.isDirty;return(0,r.useEffect)((function(){C((function(){return R}))}),[R,C]),i().createElement(u.Op,L,i().createElement(d.lVW,{className:b.A.form,onSubmit:L.handleSubmit((function(){_(!0)}),(function(){return _(!1)}))},i().createElement(p.default,{closeWorkspaceWithSavedChanges:S,conditionToEdit:E,isEditing:F,isSubmittingForm:D,patientUuid:h,setErrorCreating:z,setErrorUpdating:q,setIsSubmittingForm:_}),i().createElement("div",null,W?i().createElement("div",{className:b.A.errorContainer},i().createElement(d.jeF,{className:b.A.error,role:"alert",kind:"error",lowContrast:!0,title:T("errorCreatingCondition","Error creating condition"),subtitle:null==W?void 0:W.message})):null,U?i().createElement("div",{className:b.A.errorContainer},i().createElement(d.jeF,{className:b.A.error,role:"alert",kind:"error",lowContrast:!0,title:T("errorUpdatingCondition","Error updating condition"),subtitle:null==U?void 0:U.message})):null,i().createElement(d.Te$,{className:l()((a={},g(a,b.A.tablet,k),g(a,b.A.desktop,!k),a))},i().createElement(d.$nd,{className:b.A.button,kind:"secondary",onClick:v},T("cancel","Cancel")),i().createElement(d.$nd,{className:b.A.button,disabled:D,kind:"primary",type:"submit"},D?i().createElement(d.OuH,{className:b.A.spinner,description:T("saving","Saving")+"..."}):i().createElement("span",null,T("saveAndClose","Save & close")))))))}}}]);